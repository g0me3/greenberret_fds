
TODO


FIXED

- Криво недоупакованные 2-байта графики для концовки уровней, приводящие к тому, что у флага на вышке появляются лишние полосы во время анимации.
- Убран патч шрифтом из биоса, использован родной шрифт в упакованных ресурсах.
- Пофиксил тексты под родной шрифт.
- Добавил региональный переключатель для компиляции. Можно скомпилировать японскую версию текстов, а можно - английскую.

MISC

1. Обе версии вышли одновременно в апреле 1987 года, значит они разрабатывались практически одновременно.
2. Единственным аргументом в пользу того, что американская версия была сделана позднее, является то, что там исправлена грамматика и пунктуация в текстах. НО, есть пара нюансов, которые говорят о том, что обе версии разрабатывались на основе одной кодовой базы с основным таргетом на картриджевую консоль:
	2.1 У картриджевой версии графика несжатая. Для ФДС же графику пожали некоторым форматом, слегка сэкономив объем - у картриджевой графика занимает четыре банка по 16, а у ФДС умещается в три. Если бы ребята сначала сделали фдс версию и потом делали карик, зачем бы им было распаковывать графику и класть ее так, если можно сэкономить немного места без напряга, раз пакер был уже разработан. Вывод один - пакер был разработан и применен только исключительно для фдс версии, после того, как была сделана базовая картриджевая версия.
	2.2 Звуковой движок НЕС версии практически не использует специальную команду FD, которая является аналогом вызова подпрограммы для звукового скрипта и с помощью которой можно сэкономить место за счет свертки повторяющихся последовательностей нот. Такие команды используются только в самых последних семплах НЕС версии. В ФДС версии вся музыка переконверчена с учетом этой команды и объем звуковых данных уменьшился процентов на 20. Опять же, нет никакого смысла делать обратную конверсию, если бы игра делалась от ФДС к НЕС. Т.е. упаковку музыки опять же активно использовали именно для ФДС версии.
	2.3 Обе версии в банках графики имеют необходимые шрифты для работы (в НЕС версии буква О заменена на "НОЖ", но вместо нее используется цифра 0), но в ФДС версии почему-то используется достаточно костылеобразный хак - берутся шрифты из БИОС ФДСа и кладутся поверх исходных родных.
		2.3.1 Все это потребовалось из-за того, что оригинальная картриджевая версия своеобразно загружает имено шрифты. Первый раз шрифт кладется в память на титульном экране и в течение всей игры больше не перезагружается. Вся прочая графика просто кладется ВОКРУГ области со шрифтами и подразумевается, что они там всегда есть, за исключением случая, когда рисуется финальная заставка концовки. Переход от финальной картинки к титрам разработчиков - единственное место, где шрифты обновляются после загрузки заставочных шрифтов.
		2.3.2 В ФДС версии же область со шрифтами во время игры используется для хранения тайлов тех самых секретных подземных тоннелей, которых явно навесили апдейтом поверх исходного кода эксклюзивно для ФДС версии. Но, так как шрифт теперь испорчен, его надо все время восстанавливать. Но оригинальный шрифт запакован только с графикой титула, потому пришлось брать шрифт где-то еще. Также шрифт нужен везде, где требуется показать надпись "ЗАГРУЗКА", который изначально не предполагалось для картриджевой версии.
		2.3.3 Как следствие затирания основного шрифта во время игры, панель очков и информации вверху экрана рисуется другим набором символов с другими кодами, а когда уровень заканчивается и надо написать поздравительный текст, поверх области с символами жизней и тп снова рисуется биосовый шрифт. Получается, что панель очков и текст в этом месте просто не могут отобразиться одновременно. И Именно поэтому панель очков отсутствует на концовках уровней - ее просто отключают специально для этого места. Так что тут тоже имеем место случай, когда картриджевую версию пофиксили, чтобы помирить два конфликтующих шрифта, а не наоборот - добавили панель в картридже - нет, она там была изначально и так.
		2.3.4 Дополнительно, причиной тому, что текст концовки на красном фоне рисуется черным, является то, что биосовый шрифт имеет черный фон. Хотя в упакованной графике есть шрифт на красном фоне, его  потом нужно снова заменить на шрифт с черным фоном, чтобы оторбражать титры. В этом месте разработчики слегка схалявили, можно было бы сделать все гораздо лучше, оставить красный шрифт, а черный подгружать уже после поздравительного экрана.
	2.4 Пресловутые подземелья опять же - добавка поверх основного движка, когда люди поняли, что исходные данные умещаются в необходимый объем ФДС буфера, и еще остается место. Графика для отображения подземелий пропатчивает часть гиафики уровней в области шрифтов, которая до этого почти не использовалась иначе. Все это делается патчами на лету.
	2.5 Экран континуя - добавка над основным кодом, сделанная без особенных усилий, просто и быстро.
	2.6 В звуке не используется доп каналы. Большинство ФДС версий так или иначе используют их, потому что они разрабатывались для ФДС, но не эта игра.
3. Таким образом изначальная игра предназначалась именно для карика, но на каком-то этапе потребовалось сделать и ФДС версию, для чего картриджевый код реорганизовали, упаковали ресурсы и добавили необходимых костылей, чтобы это все работало в новых условиях. Делалось это видимо параллельно с окончанием разработки и самой картриджевой версии, которую за время, пока у ФДС версии решали задачу реорганизации ресурсов, причесали в плане пунктуации и грамматики.
4. Спрайт флажка на вышке, который трепыхается в конце каждого уровня, у ФДС версии побит в процессе запаковки ресурсов. Упакованные данные ровно на два байта меньше, чем должны быть, а так как видео память перед заливкой не чистится, то два байта могут иметь случайные значения из видеопамяти, давая ненужные артефакты на анимации.
5. В картриджевой версии есть зачатки системы повышения сложности с каждым новым прохождением. В частности, предусмотрено изменение списка врагов на каждом уровне, начиная с середины второго круга. Но как это ни странно, таблицы объектов уровня идентичные для обоих кругов. В ФДС версии эту систему улучшили, но копии списков объектов использовали для секретных подземных тоннелей вместо повышения сложности на поздних кругах. Повышение сложности сделано путем рандомного добавления врагов, выходящих с правой части экрана.
	5.1 В частности, враги, выбегающие слева, в картриджевой версии есть всегда и везде, добавляются они случайным образом по счетчику. В ФДС версии такие враги появляюся только на втором круге прохождения и в туннелях.